/* jquery.panzoom.min.js 3.2.2+ (by fr33z00) (c) Timmy Willison - MIT License */
(function(e,t){typeof define=="function"&&define.amd?define(["jquery"],function(n){return t(e,n)}):typeof exports=="object"?t(e,require("jquery")):t(e,e.jQuery)})(typeof window!="undefined"?window:this,function(e,t){"use strict";function h(e,t){var n=e.length;while(--n)if(Math.round(+e[n])!==Math.round(+t[n]))return!1;return!0}function p(e){var n={range:!0,animate:!0};return typeof e=="boolean"?n.animate=e:t.extend(n,e),n}function d(e,n,r,i,s,o,u,a,f){t.type(e)==="array"?this.elements=[+e[0],+e[2],+e[4],+e[1],+e[3],+e[5],0,0,1]:this.elements=[e,n,r,i,s,o,u||0,a||0,f||1]}function v(e,t,n){this.elements=[e,t,n]}function m(e,i){if(!(this instanceof m))return new m(e,i);e.nodeType!==1&&t.error("Panzoom called on non-Element node"),t.contains(n,e)||t.error("Panzoom element must be attached to the document");var s=t.data(e,r);if(s)return s;this.options=i=t.extend({},m.defaults,i),this.elem=e;var o=this.$elem=t(e);this.$set=i.$set&&i.$set.length?i.$set:o,this.$doc=t(e.ownerDocument||n),this.$parent=o.parent(),this.parent=this.$parent[0],this.isSVG=a.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg",this.panning=!1,this._buildTransform(),this._transform=t.cssProps.transform.replace(u,"-$1").toLowerCase(),this._buildTransition(),this.resetDimensions();var f=t(),l=this;t.each(["$zoomIn","$zoomOut","$zoomRange","$reset"],function(e,t){l[t]=i[t]||f}),this.enable(),this.scale=this.getMatrix()[0],this._checkPanWhenZoomed(),t.data(e,r,this)}var n=e.document,r="__pz__",i=Array.prototype.slice,s=/trident\/7./i,o=function(){if(s.test(navigator.userAgent))return!1;var e=n.createElement("input");return e.setAttribute("oninput","return"),typeof e.oninput=="function"}(),u=/([A-Z])/g,a=/^http:[\w\.\/]+svg$/,f="(\\-?\\d[\\d\\.e-]*)",l="\\,?\\s*",c=new RegExp("^matrix\\("+f+l+f+l+f+l+f+l+f+l+f+"\\)$");return d.prototype={x:function(e){var t=e instanceof v,n=this.elements,r=e.elements;return t&&r.length===3?new v(n[0]*r[0]+n[1]*r[1]+n[2]*r[2],n[3]*r[0]+n[4]*r[1]+n[5]*r[2],n[6]*r[0]+n[7]*r[1]+n[8]*r[2]):r.length===n.length?new d(n[0]*r[0]+n[1]*r[3]+n[2]*r[6],n[0]*r[1]+n[1]*r[4]+n[2]*r[7],n[0]*r[2]+n[1]*r[5]+n[2]*r[8],n[3]*r[0]+n[4]*r[3]+n[5]*r[6],n[3]*r[1]+n[4]*r[4]+n[5]*r[7],n[3]*r[2]+n[4]*r[5]+n[5]*r[8],n[6]*r[0]+n[7]*r[3]+n[8]*r[6],n[6]*r[1]+n[7]*r[4]+n[8]*r[7],n[6]*r[2]+n[7]*r[5]+n[8]*r[8]):!1},inverse:function(){var e=1/this.determinant(),t=this.elements;return new d(e*(t[8]*t[4]-t[7]*t[5]),e*-(t[8]*t[1]-t[7]*t[2]),e*(t[5]*t[1]-t[4]*t[2]),e*-(t[8]*t[3]-t[6]*t[5]),e*(t[8]*t[0]-t[6]*t[2]),e*-(t[5]*t[0]-t[3]*t[2]),e*(t[7]*t[3]-t[6]*t[4]),e*-(t[7]*t[0]-t[6]*t[1]),e*(t[4]*t[0]-t[3]*t[1]))},determinant:function(){var e=this.elements;return e[0]*(e[8]*e[4]-e[7]*e[5])-e[3]*(e[8]*e[1]-e[7]*e[2])+e[6]*(e[5]*e[1]-e[4]*e[2])}},v.prototype.e=d.prototype.e=function(e){return this.elements[e]},m.rmatrix=c,m.defaults={eventNamespace:".panzoom",transition:!0,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,disable1Touch:!0,which:1,increment:.3,linearZoom:!1,panOnlyWhenZoomed:!1,minScale:.3,maxScale:6,rangeStep:.05,duration:200,easing:"ease-in-out",contain:!1},m.prototype={constructor:m,instance:function(){return this},enable:function(){this._initStyle(),this._bind(),this.disabled=!1},disable:function(){this.disabled=!0,this._resetStyle(),this._unbind()},isDisabled:function(){return this.disabled},destroy:function(){this.disable(),t.removeData(this.elem,r)},resetDimensions:function(){this.container=this.parent.getBoundingClientRect();var e=this.elem,n=e.getBoundingClientRect(),r=Math.abs(this.scale);this.dimensions={width:n.width,height:n.height,left:t.css(e,"left",!0)||0,top:t.css(e,"top",!0)||0,border:{top:t.css(e,"borderTopWidth",!0)*r||0,bottom:t.css(e,"borderBottomWidth",!0)*r||0,left:t.css(e,"borderLeftWidth",!0)*r||0,right:t.css(e,"borderRightWidth",!0)*r||0},margin:{top:t.css(e,"marginTop",!0)*r||0,left:t.css(e,"marginLeft",!0)*r||0}}},reset:function(e){e=p(e);var t=this.setMatrix(this._origTransform,e);e.silent||this._trigger("reset",t)},resetZoom:function(e){e=p(e);var t=this.getMatrix(this._origTransform);e.dValue=t[3],this.zoom(t[0],e)},resetPan:function(e){var t=this.getMatrix(this._origTransform);this.pan(t[4],t[5],p(e))},setTransform:function(e){var n=this.$set,r=n.length;while(r--)t.style(n[r],"transform",e),this.isSVG&&n[r].setAttribute("transform",e)},getTransform:function(e){var n=this.$set,r=n[0];return e?this.setTransform(e):(e=t.style(r,"transform"),this.isSVG&&(!e||e==="none")&&(e=t.attr(r,"transform")||"none")),e!=="none"&&!c.test(e)&&this.setTransform(e=t.css(r,"transform")),e||"none"},getMatrix:function(e){var t=c.exec(e||this.getTransform());return t&&t.shift(),t||[1,0,0,1,0,0]},getScale:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},setMatrix:function(e,n){if(this.disabled)return;n||(n={}),typeof e=="string"&&(e=this.getMatrix(e));var r=this.getScale(e),i=typeof n.contain!="undefined"?n.contain:this.options.contain;if(i){var s=n.dims;s||(this.resetDimensions(),s=this.dimensions);var o,u,a,f=this.container,l=s.width,c=s.height,h=f.width,p=f.height,d=h/l,v=p/c;this.$parent.css("textAlign")!=="center"||t.css(this.elem,"display")!=="inline"?(a=(l-this.elem.offsetWidth)/2,o=a-s.border.left,u=l-h-a+s.border.right):o=u=(l-h)/2;var m=(c-p)/2+s.border.top,g=(c-p)/2-s.border.top-s.border.bottom;i==="invert"||i==="automatic"&&d<1.01?e[4]=Math.max(Math.min(e[4],o-s.border.left),-u):e[4]=Math.min(Math.max(e[4],o),-u),i==="invert"||i==="automatic"&&v<1.01?e[5]=Math.max(Math.min(e[5],m-s.border.top),-g):e[5]=Math.min(Math.max(e[5],m),-g)}n.animate!=="skip"&&this.transition(!n.animate),n.range&&this.$zoomRange.val(r);if(this.options.disableXAxis||this.options.disableYAxis){var y=this.getMatrix();this.options.disableXAxis&&(e[4]=y[4]),this.options.disableYAxis&&(e[5]=y[5])}return this.setTransform("matrix("+e.join(",")+")"),this.scale=r,this._checkPanWhenZoomed(r),n.silent||this._trigger("change",e),e},isPanning:function(){return this.panning},transition:function(e){if(!this._transition)return;var n=e||!this.options.transition?"none":this._transition,r=this.$set,i=r.length;while(i--)t.style(r[i],"transition")!==n&&t.style(r[i],"transition",n)},pan:function(e,t,n){if(this.options.disablePan)return;n||(n={});var r=n.matrix;r||(r=this.getMatrix()),n.relative&&(e+=+r[4],t+=+r[5]),r[4]=e,r[5]=t,this.setMatrix(r,n),n.silent||this._trigger("pan",r[4],r[5])},zoom:function(e,n){typeof e=="object"?(n=e,e=null):n||(n={});var r=t.extend({},this.options,n);if(r.disableZoom)return;var i=!1,s=r.matrix||this.getMatrix(),o=new d(s),u=this.getScale(s);typeof e!="number"?(r.linearZoom?e=1+r.increment*(e?-1:1)/u:e=e?1/(1+r.increment):1+r.increment,i=!0):e=1/u,e=Math.max(Math.min(e,r.maxScale/u),r.minScale/u);var a=o.x(new d(e,0,0,0,typeof r.dValue=="number"?r.dValue/u:e,0)),f=r.focal;if(f&&!r.disablePan){this.resetDimensions();var l=r.dims=this.dimensions,c=f.clientX,h=f.clientY;this.isSVG||(c-=l.width/u/2,h-=l.height/u/2);var p=new v(c,h,1),m=this.parentOffset||this.$parent.offset(),g=new d(1,0,m.left-this.$doc.scrollLeft(),0,1,m.top-this.$doc.scrollTop()),y=o.inverse().x(g.inverse().x(p));o=o.x(new d([e,0,0,e,0,0])),p=g.x(o.x(y)),s[4]=+s[4]+(c-p.e(0)),s[5]=+s[5]+(h-p.e(1))}s[0]=a.e(0),s[1]=a.e(3),s[2]=a.e(1),s[3]=a.e(4),this.setMatrix(s,{animate:typeof r.animate!="undefined"?r.animate:i,range:!r.noSetRange}),r.silent||this._trigger("zoom",e,r)},option:function(e,n){var r;if(!e)return t.extend({},this.options);if(typeof e=="string"){if(arguments.length===1)return this.options[e]!==undefined?this.options[e]:null;r={},r[e]=n}else r=e;this._setOptions(r)},_setOptions:function(e){t.each(e,t.proxy(function(e,n){switch(e){case"disablePan":this._resetStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._unbind()}this.options[e]=n;switch(e){case"disablePan":this._initStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":this[e]=n;case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._bind();break;case"cursor":t.style(this.elem,"cursor",n);break;case"minScale":this.$zoomRange.attr("min",n);break;case"maxScale":this.$zoomRange.attr("max",n);break;case"rangeStep":this.$zoomRange.attr("step",n);break;case"startTransform":this._buildTransform();break;case"duration":case"easing":this._buildTransition();case"transition":this.transition();break;case"panOnlyWhenZoomed":this._checkPanWhenZoomed();break;case"$set":n instanceof t&&n.length&&(this.$set=n,this._initStyle(),this._buildTransform())}},this))},_checkPanWhenZoomed:function(e){var t=this.options;if(t.panOnlyWhenZoomed){e||(e=this.getMatrix()[0]);var n=e<=t.minScale;t.disablePan!==n&&this.option("disablePan",n)}},_initStyle:function(){var e={"transform-origin":this.isSVG?"0 0":"50% 50%"};this.options.disablePan||(e.cursor=this.options.cursor),this.$set.css(e);var n=this.$parent;n.length&&!t.nodeName(this.parent,"body")&&(e={overflow:"hidden"},n.css("position")==="static"&&(e.position="relative"),n.css(e))},_resetStyle:function(){this.$elem.css({cursor:"",transition:""}),this.$parent.css({overflow:"",position:""})},_bind:function(){var e=this,n=this.options,r=n.eventNamespace,i="mousedown"+r+" pointerdown"+r+" MSPointerDown"+r,s="touchstart"+r+" "+i,u="touchend"+r+" click"+r+" pointerup"+r+" MSPointerUp"+r,a={},f=this.$reset,l=this.$zoomRange;t.each(["Start","Change","Zoom","Pan","End","Reset"],function(){var e=n["on"+this];t.isFunction(e)&&(a["panzoom"+this.toLowerCase()+r]=e)});if(!n.disablePan||!n.disableZoom)a[s]=function(t){var r;if(t.type==="touchstart"?(r=t.touches||t.originalEvent.touches)&&(r.length===1&&!n.disablePan&&!n.disable1Touch||r.length===2):!n.disablePan&&(t.which||t.originalEvent.which)===n.which)t.preventDefault(),t.stopPropagation(),e._startMove(t,r)},n.which===3&&(a.contextmenu=!1);this.$elem.on(a),f.length&&f.on(u,function(t){t.preventDefault(),e.reset()}),l.length&&l.attr({step:n.rangeStep===m.defaults.rangeStep&&l.attr("step")||n.rangeStep,min:n.minScale,max:n.maxScale}).prop({value:this.getMatrix()[0]});if(n.disableZoom)return;var c=this.$zoomIn,h=this.$zoomOut;c.length&&h.length&&(c.on(u,function(t){t.preventDefault(),e.zoom()}),h.on(u,function(t){t.preventDefault(),e.zoom(!0)})),l.length&&(a={},a[i]=function(){e.transition(!0)},a[(o?"input":"change")+r]=function(){e.zoom(+this.value,{noSetRange:!0})},l.on(a))},_unbind:function(){this.$elem.add(this.$zoomIn).add(this.$zoomOut).add(this.$reset).off(this.options.eventNamespace)},_buildTransform:function(){return this._origTransform=this.getTransform(this.options.startTransform)},_buildTransition:function(){if(this._transform){var e=this.options;this._transition=this._transform+" "+e.duration+"ms "+e.easing}},_getDistance:function(e){var t=e[0],n=e[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-t.clientX),2)+Math.pow(Math.abs(n.clientY-t.clientY),2))},_getMiddle:function(e){var t=e[0],n=e[1];return{clientX:(n.clientX-t.clientX)/2+t.clientX,clientY:(n.clientY-t.clientY)/2+t.clientY}},_trigger:function(e){typeof e=="string"&&(e="panzoom"+e),this.$elem.triggerHandler(e,[this].concat(i.call(arguments,1)))},_startMove:function(e,r){if(this.panning)return;var i,s,o,u,a,f,l,c,p=this,d=this.options,v=d.eventNamespace,m=this.getMatrix(),g=m.slice(0),y=+g[4],b=+g[5],w={matrix:m,animate:"skip"},E=e.type;E==="pointerdown"?(i="pointermove",s="pointerup"):E==="touchstart"?(i="touchmove",s="touchend"):E==="MSPointerDown"?(i="MSPointerMove",s="MSPointerUp"):(i="mousemove",s="mouseup"),i+=v,s+=v,this.transition(!0),this.panning=!0,this._trigger("start",e,r);var S=function(e,t){if(t){if(t.length===2){if(o!=null)return;o=p._getDistance(t),u=p.getScale(m),a=p._getMiddle(t);return}if(f!=null)return;if(c=t[0])f=c.pageX,l=c.pageY}if(f!=null)return;f=e.pageX,l=e.pageY};S(e,r);var x=function(e){var t;e.preventDefault(),r=e.touches||e.originalEvent.touches,S(e,r);if(r){if(r.length===2){var n=p._getMiddle(r),i=p._getDistance(r)-o,s=Math.abs(i)<Math.abs(n.clientX-a.clientX)||Math.abs(i)<Math.abs(n.clientY-a.clientY);(!d.disable1Touch||!s)&&p.zoom(i*(d.increment/100)+u,{focal:n,matrix:m,animate:"skip"}),(!d.disable1Touch||s)&&p.pan(+m[4]+n.clientX-a.clientX,+m[5]+n.clientY-a.clientY,w),a=n;return}t=r[0]||{pageX:0,pageY:0}}t||(t=e),p.pan(y+t.pageX-f,b+t.pageY-l,w)};t(n).off(v).on(i,x).on(s,function(e){e.preventDefault(),t(this).off(v),p.panning=!1,e.type="panzoomend",p._trigger(e,m,!h(m,g))})}},t.Panzoom=m,t.fn.panzoom=function(e){var n,s,o,u;return typeof e=="string"?(u=[],s=i.call(arguments,1),this.each(function(){n=t.data(this,r),n?e.charAt(0)!=="_"&&typeof (o=n[e])=="function"&&(o=o.apply(n,s))!==undefined&&u.push(o):u.push(undefined)}),u.length?u.length===1?u[0]:u:this):this.each(function(){new m(this,e)})},m});
